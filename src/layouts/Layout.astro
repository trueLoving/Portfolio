---
import BaseHead from '../components/global/BaseHead.astro';
import Analytics from '@vercel/analytics/astro'
import  SpeedInsights  from "@vercel/speed-insights/astro"
import { inferServerLocale } from '../i18n/server';

const url = new URL(Astro.request.url);
const lang = (Astro.props.lang ?? inferServerLocale({ request: Astro.request, url })) as string;
---

<html
  lang={lang}
  class='scroll-smooth selection:bg-gray-900 selection:text-white overflow-x-hidden'
>
  <head>
    <!-- 优先执行：传递服务端推断的语言给客户端，避免 hydration mismatch -->
    <script define:vars={{ serverLocale: lang }} is:inline>
      window.__SERVER_LOCALE__ = serverLocale;
    </script>
    <BaseHead
      locale={lang}
      title={Astro.props.title}
      description={Astro.props.description}
      canonical={Astro.props.canonical}
      openGraph={Astro.props.openGraph}
    />
    <Analytics />
    <SpeedInsights />
  </head>

  <body class='overflow-x-hidden bg-gray-900'>
    <slot />
  </body>
</html>
